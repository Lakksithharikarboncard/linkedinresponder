import{g as u}from"./chunks/settings-B_q-U54m.js";let o=!1;async function m(){o=(await chrome.storage.local.get(["botEnabled"])).botEnabled??!1,console.log(`[Background] Initialized. Bot enabled: ${o}`)}m();chrome.storage.onChanged.addListener((e,a)=>{a==="local"&&e.botEnabled!==void 0&&(o=e.botEnabled.newValue??!1,console.log(`[Background] Bot enabled changed: ${o}`))});const r="linkedin-scan",l=5;chrome.alarms.get(r,e=>{e||chrome.alarms.create(r,{periodInMinutes:l})});chrome.alarms.onAlarm.addListener(e=>{e.name===r&&o&&(console.log("[Background] Alarm triggered, running scan..."),g())});async function g(){try{const e=await chrome.tabs.query({url:"https://www.linkedin.com/messaging/*"});if(e.length===0){console.log("[Background] No LinkedIn messaging tabs found");return}for(const a of e)a.id!==void 0&&chrome.tabs.sendMessage(a.id,{type:"CHECK_UNREAD"}).catch(t=>{console.log(`[Background] Could not message tab ${a.id}:`,t.message)});console.log(`[Background] Sent CHECK_UNREAD to ${e.length} tab(s)`)}catch(e){console.error("[Background] Scan failed:",e)}}chrome.runtime.onMessage.addListener((e,a,t)=>(h(e,a,t),!0));async function h(e,a,t){const{type:n}=e;switch(n){case"PING_BOT":t({status:o?"running":"stopped"});break;case"START_BOT":o=!0,await chrome.storage.local.set({botEnabled:!0}),console.log("[Background] Bot started via message"),t({status:"running"});break;case"STOP_BOT":o=!1,await chrome.storage.local.set({botEnabled:!1}),console.log("[Background] Bot stopped via message"),t({status:"stopped"});break;case"RUN_SCAN_NOW":o?(g(),t({status:"running"})):t({status:"stopped"});break;case"GET_SETTINGS":try{const c=await u();t({status:"ok",settings:c})}catch(c){t({status:"error",error:String(c)})}break;case"TEST_API_KEY":await b({provider:e.provider,key:e.key},t);break;default:console.log(`[Background] Unknown message type: ${n}`),t({status:"unknown"})}}async function b(e,a){const{provider:t,key:n}=e;if(!(n!=null&&n.trim())){a({success:!1,message:"Key is empty"});return}const i={openai:"https://api.openai.com/v1/models",groq:"https://api.groq.com/openai/v1/models",groq2:"https://api.groq.com/openai/v1/models",routeway:"https://api.routeway.ai/v1/models"}[t];if(!i){a({success:!1,message:"Unknown provider"});return}try{const s=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${n}`}}),d=`${s.status} ${s.statusText}${s.status===429?" (rate limited)":""}`;a({success:s.ok,message:d})}catch(s){a({success:!1,message:(s==null?void 0:s.message)||"Request failed"})}}chrome.runtime.onInstalled.addListener(e=>{console.log(`[Background] Extension installed/updated: ${e.reason}`),chrome.alarms.get(r,a=>{a||(chrome.alarms.create(r,{periodInMinutes:l}),console.log("[Background] Scan alarm created"))})});
