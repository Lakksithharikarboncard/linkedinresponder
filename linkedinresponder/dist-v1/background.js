import{g as i}from"./chunks/settings-CcKZdnrf.js";let o=!1;async function g(){o=(await chrome.storage.local.get(["botEnabled"])).botEnabled??!1,console.log(`[Background] Initialized. Bot enabled: ${o}`)}g();chrome.storage.onChanged.addListener((e,t)=>{t==="local"&&e.botEnabled!==void 0&&(o=e.botEnabled.newValue??!1,console.log(`[Background] Bot enabled changed: ${o}`))});const n="linkedin-scan",c=5;chrome.alarms.create(n,{periodInMinutes:c});chrome.alarms.onAlarm.addListener(e=>{e.name===n&&o&&(console.log("[Background] Alarm triggered, running scan..."),l())});async function l(){try{const e=await chrome.tabs.query({url:"https://www.linkedin.com/messaging/*"});if(e.length===0){console.log("[Background] No LinkedIn messaging tabs found");return}for(const t of e)t.id!==void 0&&chrome.tabs.sendMessage(t.id,{type:"CHECK_UNREAD"}).catch(a=>{console.log(`[Background] Could not message tab ${t.id}:`,a.message)});console.log(`[Background] Sent CHECK_UNREAD to ${e.length} tab(s)`)}catch(e){console.error("[Background] Scan failed:",e)}}chrome.runtime.onMessage.addListener((e,t,a)=>(d(e,t,a),!0));async function d(e,t,a){const{type:s}=e;switch(s){case"PING_BOT":a({status:o?"running":"stopped"});break;case"START_BOT":o=!0,await chrome.storage.local.set({botEnabled:!0}),console.log("[Background] Bot started via message"),a({status:"running"});break;case"STOP_BOT":o=!1,await chrome.storage.local.set({botEnabled:!1}),console.log("[Background] Bot stopped via message"),a({status:"stopped"});break;case"RUN_SCAN_NOW":o?(l(),a({status:"running"})):a({status:"stopped"});break;case"GET_SETTINGS":try{const r=await i();a({status:"ok",settings:r})}catch(r){a({status:"error",error:String(r)})}break;default:console.log(`[Background] Unknown message type: ${s}`),a({status:"unknown"})}}chrome.runtime.onInstalled.addListener(e=>{console.log(`[Background] Extension installed/updated: ${e.reason}`),chrome.alarms.get(n,t=>{t||(chrome.alarms.create(n,{periodInMinutes:c}),console.log("[Background] Scan alarm created"))})});
